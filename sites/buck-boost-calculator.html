<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buck / Boost Converter Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Icons -->
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- Font Awesome for theme icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Shared responsive CSS (your existing file) -->
  <link rel="stylesheet" href="responsive.css">

  <style>
    :root {
      --primary-color: #4e9eff;
      --primary-dark: #3a6cf4;
      --primary-light: #6ab1ff;
      --background-dark: #121212;
      --background-darker: #0a0a0a;
      --background-secondary: #1a1a1a;
      --card-dark: #1e1e1e;
      --card-light: #252525;
      --text-light: #ffffff;
      --text-muted: #aaaaaa;
      --success-color: #4caf50;
      --error-color: #f44336;
      --transition-speed: 0.3s;
      --border-radius: 12px;
      --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      --box-shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    /* Light mode variables */
    [data-theme="light"] {
      --background-dark: #f5f7fa;
      --background-darker: #e8ebf0;
      --background-secondary: #ffffff;
      --card-dark: #ffffff;
      --card-light: #f9f9f9;
      --text-light: #333333;
      --text-muted: #666666;
      --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      --box-shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--background-dark);
      color: var(--text-light);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      transition: background-color var(--transition-speed) ease,
                  color var(--transition-speed) ease;
    }

    h1, h2, h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .section-subtitle {
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .calculator-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .calculator {
      background-color: var(--card-dark);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
      transition: all var(--transition-speed) ease;
    }

    .calculator:hover {
      box-shadow: var(--box-shadow-hover);
      transform: translateY(-2px);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 20px;
    }

    .form-group {
      margin-bottom: 18px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--primary-color);
    }

    select, input {
      width: 100%;
      padding: 10px 14px;
      border-radius: var(--border-radius);
      border: 1px solid var(--background-secondary);
      background-color: var(--background-secondary);
      color: var(--text-light);
      font-size: 1em;
      font-family: inherit;
      transition: all var(--transition-speed) ease;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(78, 158, 255, 0.25);
    }

    .unit {
      font-size: 0.85em;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .helper-text {
      font-size: 0.85em;
      color: var(--text-muted);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 11px 22px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 1em;
      border: none;
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      background-color: var(--primary-color);
      color: #fff;
      box-shadow: 0 6px 18px rgba(78, 158, 255, 0.4);
      margin-right: 10px;
      margin-top: 10px;
    }

    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 10px 28px rgba(78, 158, 255, 0.6);
    }

    .btn-secondary {
      background-color: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      box-shadow: none;
    }

    .btn-secondary:hover {
      background-color: var(--primary-color);
      color: #fff;
    }

    .results {
      margin-top: 22px;
      padding: 18px;
      border-radius: var(--border-radius);
      border-left: 4px solid var(--primary-color);
      background-color: rgba(78, 158, 255, 0.08);
      display: none;
    }

    .results p {
      margin-bottom: 6px;
    }

    .results-title {
      font-weight: 700;
      margin-bottom: 8px;
    }

    .results-error {
      color: var(--error-color);
      font-weight: 600;
      margin-top: 6px;
    }

    .formula {
      margin-top: 10px;
      font-size: 0.9em;
      color: var(--text-muted);
      font-style: italic;
    }

    .info-section {
      margin-top: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background-color: var(--card-dark);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
    }

    th, td {
      text-align: left;
      padding: 10px 14px;
      border-bottom: 1px solid var(--background-secondary);
      font-size: 0.93em;
    }

    th {
      background-color: var(--primary-color);
      color: #fff;
      font-weight: 600;
    }

    tr:hover {
      background-color: var(--background-secondary);
    }

    .assumptions {
      margin-top: 10px;
      font-size: 0.9em;
      color: var(--text-muted);
    }

    /* Theme toggle */
    .theme-toggle {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--card-dark);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      z-index: 999;
    }

    .theme-toggle:hover {
      transform: scale(1.08);
    }

    footer {
      background-color: var(--card-dark);
      color: var(--text-light);
      text-align: center;
      padding: 25px;
      margin-top: 35px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .social-footer {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
    }

    .social-footer a {
      color: var(--text-light);
      font-size: 1.5em;
      transition: all var(--transition-speed) ease;
    }

    .social-footer a:hover {
      color: var(--primary-color);
      transform: translateY(-3px);
    }

    .footer-bottom {
      margin-top: 10px;
      font-size: 0.9em;
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .calculator {
        padding: 18px;
      }
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="calculator-container">
    <h1>Buck / Boost Converter Calculator</h1>
    <p class="section-subtitle">
      Ideal continuous-mode design helper for step-down (buck) and step-up (boost) converters.
      Inputs: Vin, Vout, Power, switching frequency.
    </p>

    <div class="calculator">
      <div class="form-group">
        <label for="mode">Converter Type</label>
        <select id="mode">
          <option value="buck">Buck (Step-Down)</option>
          <option value="boost">Boost (Step-Up)</option>
        </select>
        <p class="helper-text">Buck: Vout &lt; Vin &nbsp;&nbsp;|&nbsp;&nbsp; Boost: Vout &gt; Vin</p>
      </div>

      <div class="grid-2">
        <div>
          <div class="form-group">
            <label for="vin">Input Voltage Vin</label>
            <input type="number" id="vin" placeholder="e.g. 24">
            <div class="unit">Volts [V]</div>
          </div>

          <div class="form-group">
            <label for="vout">Output Voltage Vout</label>
            <input type="number" id="vout" placeholder="e.g. 12">
            <div class="unit">Volts [V]</div>
          </div>
        </div>

        <div>
          <div class="form-group">
            <label for="power">Output Power Pout</label>
            <input type="number" id="power" placeholder="e.g. 100">
            <div class="unit">Watts [W]</div>
          </div>

          <div class="form-group">
            <label for="freq">Switching Frequency</label>
            <input type="number" id="freq" placeholder="e.g. 500">
            <div class="unit">kHz (e.g. 100 → 100 kHz)</div>
          </div>
        </div>
      </div>

      <button class="btn" id="calc-btn">
        <i class="fas fa-bolt" style="margin-right:8px;"></i>Calculate
      </button>
      <button class="btn btn-secondary" id="clear-btn">
        <i class="fas fa-broom" style="margin-right:6px;"></i>Clear
      </button>

      <div class="results" id="results">
        <p class="results-title">Results</p>
        <p id="result-duty"></p>
        <p id="result-inductor"></p>
        <p id="result-capacitor"></p>
        <p id="result-currents"></p>
        <p id="result-eff"></p>
        <p id="error-msg" class="results-error"></p>
        <p class="formula" id="formula-text"></p>
        <p class="assumptions">
          Assumptions: Continuous conduction mode, inductor ripple ≈ 30% of DC current,
          output voltage ripple ≈ 1% of Vout, typical efficiency 90% (buck) / 88% (boost).
        </p>
      </div>
    </div>

    <div class="info-section">
      <h2>Design Equations (Ideal CCM)</h2>
      <table>
        <tr>
          <th>Quantity</th>
          <th>Buck Converter</th>
          <th>Boost Converter</th>
        </tr>
        <tr>
          <td>Duty Cycle D</td>
          <td>D = Vout / Vin</td>
          <td>D = 1 − Vin / Vout</td>
        </tr>
        <tr>
          <td>Inductor Current (approx.)</td>
          <td>I<sub>out</sub> = Pout / Vout</td>
          <td>I<sub>in</sub> = Pout / (Vin · η)</td>
        </tr>
        <tr>
          <td>Inductor Ripple ΔI<sub>L</sub></td>
          <td colspan="2">ΔI<sub>L</sub> ≈ 0.3 · I<sub>DC</sub> (30% ripple)</td>
        </tr>
        <tr>
          <td>Inductance L</td>
          <td>L = (Vin − Vout) · D / (ΔI<sub>L</sub> · f<sub>sw</sub>)</td>
          <td>L = Vin · D / (ΔI<sub>L</sub> · f<sub>sw</sub>)</td>
        </tr>
        <tr>
          <td>Output Voltage Ripple ΔV</td>
          <td colspan="2">ΔV ≈ 0.01 · Vout (1% ripple assumed)</td>
        </tr>
        <tr>
          <td>Output Capacitor C</td>
          <td>C ≈ I<sub>out</sub> · D / (f<sub>sw</sub> · ΔV)</td>
          <td>C ≈ I<sub>out</sub> · D / (f<sub>sw</sub> · ΔV)</td>
        </tr>
      </table>
    </div>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
    <i class="fas fa-moon"></i>
  </button>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="social-footer">
        <a href="https://www.linkedin.com/in/mohamedtarek225" target="_blank" aria-label="LinkedIn" rel="noopener noreferrer">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="https://github.com/mohamed22tarek5" target="_blank" aria-label="GitHub" rel="noopener noreferrer">
          <i class="fab fa-github"></i>
        </a>
        <a href="https://www.instagram.com/_m7md_tarek_/?igshid=YmMyMTA2M2Y%3D" target="_blank" aria-label="Instagram" rel="noopener noreferrer">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://wa.me/+201090637406" target="_blank" aria-label="WhatsApp" rel="noopener noreferrer">
          <i class="fab fa-whatsapp"></i>
        </a>
      </div>
      <div class="footer-bottom">
        &copy; <span id="current-year">2025</span> Mohamed Tarek Portfolio. All Rights Reserved.
        &nbsp;|&nbsp; &copy; M.T.A.
      </div>
    </div>
  </footer>

  <script>
    // ---------- Theme handling ----------
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = themeToggle.querySelector('i');

    const savedTheme = localStorage.getItem('theme') ||
      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

    document.body.setAttribute('data-theme', savedTheme);
    if (savedTheme === 'dark') {
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
    } else {
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
    }

    themeToggle.addEventListener('click', () => {
      const current = document.body.getAttribute('data-theme');
      if (current === 'light') {
        document.body.setAttribute('data-theme', 'dark');
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.setAttribute('data-theme', 'light');
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
        localStorage.setItem('theme', 'light');
      }
    });

    // ---------- Helpers ----------
    function fmt(val, digits = 3) {
      if (!isFinite(val)) return '';
      const absVal = Math.abs(val);
      if (absVal === 0) return '0';
      if (absVal >= 1000 || absVal < 0.001) {
        return val.toExponential(digits);
      }
      return parseFloat(val.toFixed(digits)).toString();
    }

    function toNumber(input) {
      const v = parseFloat(input);
      return isNaN(v) ? null : v;
    }

    // ---------- Calculator logic ----------
    const vinEl = document.getElementById('vin');
    const voutEl = document.getElementById('vout');
    const powerEl = document.getElementById('power');
    const freqEl = document.getElementById('freq');
    const modeEl = document.getElementById('mode');

    const resultsBox = document.getElementById('results');
    const dutyEl = document.getElementById('result-duty');
    const indEl = document.getElementById('result-inductor');
    const capEl = document.getElementById('result-capacitor');
    const currentsEl = document.getElementById('result-currents');
    const effEl = document.getElementById('result-eff');
    const errEl = document.getElementById('error-msg');
    const formulaEl = document.getElementById('formula-text');

    document.getElementById('calc-btn').addEventListener('click', () => {
      errEl.textContent = '';
      formulaEl.textContent = '';
      resultsBox.style.display = 'block';

      const mode = modeEl.value;           // "buck" or "boost"
      const Vin = toNumber(vinEl.value);
      const Vout = toNumber(voutEl.value);
      const Pout = toNumber(powerEl.value);
      const f_kHz = toNumber(freqEl.value);

      if (Vin === null || Vout === null || Pout === null || f_kHz === null ||
          Vin <= 0 || Vout <= 0 || Pout <= 0 || f_kHz <= 0) {
        errEl.textContent = 'Please enter positive numeric values for Vin, Vout, Power, and Frequency.';
        dutyEl.textContent = '';
        indEl.textContent = '';
        capEl.textContent = '';
        currentsEl.textContent = '';
        effEl.textContent = '';
        return;
      }

      const fsw = f_kHz * 1000; // Hz

      // ripple assumptions
      const ripple_I_ratio = 0.30;   // 30% of DC current
      const ripple_V_ratio = 0.01;   // 1% of Vout

      let D, Iout, Iin, ILdc, dIL, L, dV, C, etaTyp;

      if (mode === 'buck') {
        if (Vout >= Vin) {
          errEl.textContent = 'For buck mode, Vout must be lower than Vin.';
          dutyEl.textContent = '';
          indEl.textContent = '';
          capEl.textContent = '';
          currentsEl.textContent = '';
          effEl.textContent = '';
          return;
        }

        // Duty cycle
        D = Vout / Vin;

        // Output current
        Iout = Pout / Vout;

        // DC inductor current (buck: equal to output current in ideal CCM)
        ILdc = Iout;

        // Ripple current
        dIL = ripple_I_ratio * ILdc;

        // Inductor
        // L = (Vin - Vout) * D / (ΔIL * fsw)
        L = (Vin - Vout) * D / (dIL * fsw);

        // Output ripple voltage
        dV = ripple_V_ratio * Vout;

        // Capacitor (simple approx)
        // C ≈ Iout * D / (fsw * ΔV)
        C = Iout * D / (fsw * dV);

        // Typical efficiency assumption
        etaTyp = 0.90; // 90%
        Iin = Pout / (Vin * etaTyp);

        formulaEl.textContent =
          'Buck: D = Vout / Vin;  L = (Vin − Vout)·D / (ΔIL·f_sw);  ' +
          'C ≈ Iout·D / (f_sw·ΔVout).';

      } else {
        // boost
        if (Vout <= Vin) {
          errEl.textContent = 'For boost mode, Vout must be higher than Vin.';
          dutyEl.textContent = '';
          indEl.textContent = '';
          capEl.textContent = '';
          currentsEl.textContent = '';
          effEl.textContent = '';
          return;
        }

        // Duty cycle
        D = 1 - (Vin / Vout);

        // Efficiency assumption first to get currents
        etaTyp = 0.88; // 88% typical
        Iout = Pout / Vout;
        Iin = Pout / (Vin * etaTyp);

        ILdc = Iin; // inductor current ≈ input current

        // Ripple current
        dIL = ripple_I_ratio * ILdc;

        // Inductor
        // L = Vin·D / (ΔIL·fsw)
        L = Vin * D / (dIL * fsw);

        // Output ripple voltage
        dV = ripple_V_ratio * Vout;

        // Capacitor
        // C ≈ Iout·D / (fsw·ΔVout)
        C = Iout * D / (fsw * dV);

        formulaEl.textContent =
          'Boost: D = 1 − Vin / Vout;  L = Vin·D / (ΔIL·f_sw);  ' +
          'C ≈ Iout·D / (f_sw·ΔVout).';
      }

      // Safety checks
      if (!isFinite(D) || !isFinite(L) || !isFinite(C) ||
          D <= 0 || D >= 1 || L <= 0 || C <= 0) {
        errEl.textContent = 'The values lead to invalid component sizes. Check Vin, Vout, Pout, and frequency.';
        dutyEl.textContent = '';
        indEl.textContent = '';
        capEl.textContent = '';
        currentsEl.textContent = '';
        effEl.textContent = '';
        return;
      }

      // Present results
      const D_percent = D * 100;

      dutyEl.textContent =
        `Duty cycle D ≈ ${fmt(D, 4)}  (≈ ${fmt(D_percent, 2)} %)`;

      // Convert L to µH and C to µF for readability
      const L_uH = L * 1e6;
      const C_uF = C * 1e6;

      indEl.textContent =
        `Required inductance L ≈ ${fmt(L_uH)} µH  (≈ ${fmt(L, 6)} H)`;

      capEl.textContent =
        `Output capacitor C ≈ ${fmt(C_uF)} µF  (≈ ${fmt(C, 6)} F)`;

      currentsEl.textContent =
        `Approximate currents:  Iout ≈ ${fmt(Iout)} A,  Iin ≈ ${fmt(Iin)} A (with assumed efficiency).`;

      effEl.textContent =
        `Estimated practical efficiency ≈ ${Math.round(etaTyp * 100)} % (rule-of-thumb, not exact).`;

      errEl.textContent = '';
    });

    document.getElementById('clear-btn').addEventListener('click', () => {
      vinEl.value = '';
      voutEl.value = '';
      powerEl.value = '';
      freqEl.value = '';
      resultsBox.style.display = 'none';
      dutyEl.textContent = '';
      indEl.textContent = '';
      capEl.textContent = '';
      currentsEl.textContent = '';
      effEl.textContent = '';
      errEl.textContent = '';
      formulaEl.textContent = '';
    });

    // Footer year
    document.getElementById('current-year').textContent =
      new Date().getFullYear();
  </script>
</body>
</html>
